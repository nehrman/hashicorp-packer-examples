{
    "variables": {
        "format": "vmx",
        "iso_checksum": "7f0eb16e287e732af4046359184cf6f7",
        "iso_url": "file:/Users/nicolas/Downloads/rhel-server-7.6-x86_64-dvd.iso",
        "remote_datastore": "datastore1",
        "esx_host": "esx01",
        "esx_password": "{{ vault `/secret/data/packer/esx` `password`}}",
        "esx_username": "{{ vault `/secret/data/packer/esx` `username`}}",
        "vcenter_host": "esx01",
        "vcenter_password": "{{ vault `/secret/data/packer/vcenter` `password`}}",
        "vcenter_username": "{{ vault `/secret/data/packer/vcenter` `username`}}",
        "version": "0.1",
        "vm_name": "packer-test"
    },
    
    "sensitive-variables": [
       "remote_password"
    ],  

    "builders": [
      { 
        "type": "vmware-iso",
        
        "floppy_files": [
            "ks.cfg"
        ],
        
        "boot_command": [
          "<tab> inst.text inst.ks=hd:fd0:/ks.cfg <enter><wait>",
          "<wait10><enter>",
          "<wait10><esc>"
        ],

        "boot_wait": "10s",
        "cores": "1",
        "cpus": "2",
        "disk_size": "20000",
        "disk_type_id": "zeroedthick",
        "display_name": "{{ user `vm_name` }}-{{ user `version` }}",
        "format": "{{ user `format` }}",
        "guest_os_type": "rhel7-64",
        "http_directory": "http",
        "iso_checksum": "{{ user `iso_checksum` }}",
        "iso_checksum_type": "md5",
        "iso_url": "{{ user `iso_url` }}",
        "keep_registered": "true",
        "memory": "4096",
        "output_directory": "output-packer",
        "remote_datastore": "{{ user `remote_datastore`}}",
        "remote_host": "{{ user `esx_host`}}",
        "remote_password": "{{ user `esx_password`}}",
        "remote_type": "esx5",
        "remote_username": "{{ user `esx_username`}}",
        "shutdown_command": "shutdown -h now",
        "skip_compaction": true,
        "skip_export": "true",
        "ssh_password": "packer",
        "ssh_username": "packer",
        "ssh_timeout": "1h",
        "vm_name": "{{ user `vm_name` }}-{{ user `version` }}",
        "vmx_data": {
            "ethernet0.networkName": "packer"
        },
        "vnc_disable_password": "true",
        "vnc_port_max": "6199",
        "vnc_port_min": "5900"
      }
    ],
   
    "provisioners": [

    ],

    "post-processors": [
        {
            "type": "vsphere-template",
            "host": "{{ user `vcenter_host`}}",
            "insecure": "true",
            "username": "{{ user `vcenter_username`}}",
            "password": "{{ user `vcenter_password`}}",
            "datacenter": "{{ user `vmw_datacenter`}}",
            "folder": "{{ user `vcenter_folder`}}"
        }
    ] 
  }